<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TD3</title>
   
</head>
<body>

  

   <section id="task1">
    <h2>location</h2>
    
    <button onclick="getLocation()">location</button>
    
    <p id="location-output"></p>
  </section>
    <hr>

   <section id="task2">
    <h2> Enregistreur Video</h2>
    <button onclick="activateCamera()">Activer Camera</button>
    <video id="camera-stream" autoplay playsinline></video>
    <hr>
    <div>
        <button id="start-btn" onclick="startRecording()" disabled>Demarrer</button>
        <button id="stop-btn" onclick="stopRecording()" disabled>Arreter</button>
    </div>
    <p id="camera-status">Statut : Inactif</p>
</section>

    <hr>

    <section id="task3">
        <h2> ficheiers</h2>
        <form id="upload-form">
            <label for="file-input">ficheier:</label>
            <input type="file" id="file-input" name="uploadedFile" multiple required>
            <br><br>
            <button type="submit">upload</button>
        </form>
        <p id="upload-status">No file selected.</p>
    </section>

    <script>
        //I'll use templete leterale because fuck concatination 
      
        // exo1
   
          function getLocation() {
            const output = document.getElementById('location-output');
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        output.innerHTML = `
                            Latitude: ${lat.toFixed(6)}<br>
                            Longitude: ${lon.toFixed(6)}
                        `
                    }
                    
                );
            } 
        }


//////////////////////////////////////////////////
        // exo2
      let mediaRecorder;
let recordedChunks = [];
let stream;

const videoElement = document.getElementById('camera-stream');
const statusElement = document.getElementById('camera-status');
const startButton = document.getElementById('start-btn');
const stopButton = document.getElementById('stop-btn');

function activateCamera() {
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
       
        navigator.mediaDevices.getUserMedia({ video: true, audio: true }) 
            .then((cameraStream) => {
                stream = cameraStream;
                videoElement.srcObject = stream;
                statusElement.textContent = "Statut : Camera active. Appuyez sur Demarrer.";
                startButton.disabled = false; 

                mediaRecorder = new MediaRecorder(stream);

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    
                    const downloadLink = document.createElement('a');
                    downloadLink.href = url;
                    downloadLink.download = `enregistrement_${new Date().toISOString()}.webm`;
                    downloadLink.textContent = 'vidio engestree';
                    
                    statusElement.innerHTML = 'terminer.';
                    statusElement.appendChild(downloadLink);
                    recordedChunks = []; 
                    
                    startButton.disabled = false;
                    stopButton.disabled = true;
                };
            })
            .catch(error => {
                statusElement.textContent = `Erreur d'acces a la camera : ${error.name} - ${error.message}`;
            });
    } 
}

function startRecording() {
    if (mediaRecorder && mediaRecorder.state === 'inactive') {
        recordedChunks = []; 
        mediaRecorder.start();
        statusElement.textContent = "Statut : ENREGISTREMENT EN COURS...";
        startButton.disabled = true;
        stopButton.disabled = false;
    }
}

function stopRecording() {
    if (mediaRecorder && mediaRecorder.state === 'recording') {
        mediaRecorder.stop();
        statusElement.textContent = "Statut : Arret. Preparation du telechargement...";
        stopButton.disabled = true;
    }
}
////////////////////////////

// exo3
document.getElementById('upload-form').addEventListener('submit', function(event) {
    event.preventDefault(); 
    const fileInput = document.getElementById('file-input');
    const statusElement = document.getElementById('upload-status');
    statusElement.innerHTML = ''; 

    if (fileInput.files.length > 0) {
        let output = "<h3>Fichiers selectionnes :</h3><ul>";
        
        for (let i = 0; i < fileInput.files.length; i++) {
            const file = fileInput.files[i];
            
            const fileSize = (file.size / 1024).toFixed(2);
            const fileType = file.type || "Inconnu";
            
            output += `<li>
                <a href="#" class="file-link" 
                   data-name="${file.name}" 
                   data-size="${fileSize} KB" 
                   data-type="${fileType}">
                    ${file.name}
                </a> 
                <span>
                    (${fileSize} KB, Type: ${fileType})
                </span>
            </li>`;
        }
        
        output += "</ul>";
        statusElement.innerHTML = output;
        
        attachFileClickHandlers();

    } else {
        statusElement.innerHTML = "Veuillez sélectionner au moins un fichier.";
    }
});


function attachFileClickHandlers() {
    const fileLinks = document.querySelectorAll('.file-link');
    
    fileLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault(); 
            
            const name = this.getAttribute('data-name');
            const size = this.getAttribute('data-size');
            const type = this.getAttribute('data-type');
            
            alert(`Détails du fichier :\n\nNom: ${name}\nTaille: ${size}\nType: ${type}`);
        });
    });
}

    </script>
</body>
</html>